<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../d2l-typography/d2l-typography-shared-styles.html">
<link rel="import" href="../../d2l-icons/d2l-icon.html">
<link rel="import" href="../../d2l-icons/tier1-icons.html">
<link rel="import" href="../localize-behavior.html">

<dom-module id="d2l-rubric-editor-save-status">
	<template strip-whitespace>
		<style>
			:host {
				display: block;
				color: #72777a;
			}

			.check-icon {
				width: 0.8rem;
				height: 0.8rem;
				margin-right: 8px;
			}

			.status-text {
				@apply --d2l-body-compact-text;
				font-style: italic;
			}

			:host-context([dir='rtl']) .check-icon {
				margin-left: 8px;
			}

			:host(:dir(rtl)) .check-icon {
				margin-left: 8px;
			}
		</style>
		<div hidden aria-live="polite" id="save-status-announce"></div>
		<div id="saving-status-indicator" hidden>
			<d2l-icon class="check-icon"></d2l-icon>
			<label class="status-text">[[localize('entity-saving')]]</label>
		</div>
		<div id="saved-status-indicator" hidden>
			<d2l-icon icon="d2l-tier1:check" class="check-icon"></d2l-icon>
			<label class="status-text">[[localize('entity-saved')]]</label>
		</div>
	</template>
	<script>
		(function () {
			var debounce = function (func, delay) {
				var timeout
				return function () {
					var context = this;
					var args = arguments;
					clearTimeout(timeout);
					timeout = setTimeout(function () { func.apply(context, args) }, delay);
				}
			};

			Polymer({
				is: 'd2l-rubric-editor-save-status',
				behaviors: [
					D2L.PolymerBehaviors.Rubric.LocalizeBehavior
				],

				properties: {

				},

				ready: function () {
					var self = this;
					this._handleSaved = debounce(function () {
						self._toggleVisible('saved-status-indicator', 'saving-status-indicator');
						self.$['save-status-announce'].innerText = this.localize('entity-saved');
					}, 500);
					this._handleError = debounce(function() {
						self.$['saving-status-indicator'].hidden = true;
						self.$['save-status-announce'].innerText = '';
					}, 100);
				},

				_toggleVisible: function (show, hidden) {
					this.$[show].hidden = false;
					this.$[hidden].hidden = true;
				},
				start: function() {
					this._toggleVisible('saving-status-indicator', 'saved-status-indicator');
					this.$['save-status-announce'].innerText = this.localize('entity-saving');
				},
				end: function() {
					this._handleSaved();
				},
				error: function() {
					this._handleError();
				}
			});
		})();
	</script>
</dom-module>
