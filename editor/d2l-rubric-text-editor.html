<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../d2l-inputs/d2l-input-textarea.html">

<link rel="import" href="./d2l-rubric-html-editor.html">

<dom-module id="d2l-rubric-text-editor">
	<template>
	<style>
		:host {
			line-height: 1rem;
			display: flex;

			--d2l-input-textarea: {

				min-height: 0;
				overflow: hidden;
				hyphens: auto;
			};
		}

		[hidden] {
			display: none;
		}

		* {
			box-sizing: border-box;
		}

	</style>
		<template is="dom-if" if="[[!richTextEnabled]]">
			<d2l-input-textarea
				id="textEditor"
				hidden$=[[richTextEnabled]]
				aria-invalid="[[ariaInvalid]]"
				aria-label="[[ariaLabel]]"
				disabled="[[disabled]]"
				no-border
				hover-styles
				value=[[value]]
				on-change="_onInputChange"
			></d2l-input-textarea>
		</template>
		<template is="dom-if" if="[[richTextEnabled]]">
			<d2l-rubric-html-editor
				id="htmlEditor"
				hidden$=[[!richTextEnabled]]
				aria-label=[[ariaLabel]]
				invalid=[[_stringIsTrue(ariaInvalid)]]
				language=[[language]]
				placeholder=[[placeholder]]
				value=[[value]]
				key=[[key]]
				min-rows=[[minRows]]
				max-rows=[[maxRows]]
				on-change="_onInputChange"
			></d2l-rubric-html-editor>
		</template>
	</template>

	<script>
		Polymer({
			is: 'd2l-rubric-text-editor',
			properties: {
				key: String,
				language: String,
				ariaLabel: {
					type: String,
				},
				ariaInvalid: {
					type: Boolean,
					value: false,
				},
				placeholder: {
					type: String,
				},
				value: {
					type: String,
					notify: true,
				},
				richTextEnabled: {
					type: Boolean,
					value: false,
				},
				disabled: {
					type: Boolean,
					value: false,
				}
			},
			focus: function() {
				if (this.richTextEnabled) {
					this.$$('#htmlEditor').focus();
				} else {
					this.$$('#textEditor').focus();
				}
			},
			_stringIsTrue: function(string) {
				return string && string === 'true';
			},
			_onInputChange: function(e) {
				e.stopPropagation();
				var value = (e.detail && e.detail.content) || e.target.value || '';
				this.fire('change', { value: value });
			},
		});
	</script>
</dom-module>
