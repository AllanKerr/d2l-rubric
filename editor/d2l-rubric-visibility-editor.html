<link rel="import" href="../../polymer/polymer.html">

<link rel="import" href="../../d2l-colors/d2l-colors.html">
<link rel="import" href="../../d2l-typography/d2l-typography-shared-styles.html">
<link rel="import" href="../../iron-a11y-announcer/iron-a11y-announcer.html">
<link rel="import" href="../../d2l-tooltip/d2l-tooltip.html">
<link rel="import" href="../../d2l-hm-constants-behavior/d2l-hm-constants-behavior.html">
<link rel="import" href="../../d2l-inputs/d2l-input-checkbox.html">
<link rel="import" href="../../d2l-polymer-siren-behaviors/store/siren-action-behavior.html">

<link rel="import" href="./../d2l-rubric-entity-behavior.html">
<link rel="import" href="./../localize-behavior.html">

<link rel="import" href="./d2l-rubric-error-handling-behavior.html">
<link rel="import" href="./d2l-input-radio-rubric.html">

<dom-module id="d2l-rubric-visibility-editor">
	<template strip-whitespace>
		<style>
			label {
				@apply --d2l-label-text;
			}
			.heading {
				display: inline-block;
				margin-bottom: 0.5rem;
			}
			d2l-input-radio-rubric {
				display: block;
			}
			d2l-input-radio-rubric:last-of-type  {
				/* This is required because we cannot override the internal bottom margin on the radio button - yuck to light dom */
				margin-bottom: -0.9rem;
			}
		</style>
		<label class="heading" for="hide-score-checkbox">[[localize('rubricVisibility')]]</label>
		<d2l-input-radio-rubric id="AlwaysVisible" name="visibility">[[localize('rubricVisibilityAlways')]]</d2l-input-radio-rubric>
		<d2l-input-radio-rubric id="VisibleOnceFeedbackPosted" name="visibility">[[localize('rubricVisibilityOnceFeedbackPosted')]]</d2l-input-radio-rubric>
		<d2l-input-radio-rubric id="NeverVisible" name="visibility">[[localize('rubricVisibilityNever')]]</d2l-input-radio-rubric>
	</template>
	<script>
		Polymer({
			is: 'd2l-rubric-visibility-editor',
			properties: {
				/**
				* The href for this siren entity
				*/
				href: {
					type: String,
					reflectToAttribute: true
				},
				/**
				* The user access token
				*/
				token: {
					type: Object,
				},
				_selected: {
					type: String,
					observer: '_updateSelected'
				}
			},
			behaviors: [
				D2L.PolymerBehaviors.Rubric.EntityBehavior,
				D2L.PolymerBehaviors.Siren.SirenActionBehavior,
				window.D2L.Hypermedia.HMConstantsBehavior,
				D2L.PolymerBehaviors.Rubric.LocalizeBehavior,
				D2L.PolymerBehaviors.Rubric.ErrorHandlingBehavior,
			],
			_onEntityChanged: function(entity) {
				var action = entity && entity.getActionByName('update-visibility');
				if (action) {
					var field = action.getFieldByName('visibility');
					if (field && Array.isArray(field.value)) {
						for (var i = 0; i < field.value.length; i++) {
							if (field.value[i].selected) {
								this._selected = field.value[i].value;
							}
						}
					}
				}
			},
			_updateSelected: function(selected) {
				Polymer.dom(this.root).querySelector('#' + selected).checked = true;
			}
		});
	</script>
</dom-module>
